# SID

## Introduction and data model

Identity is an application for the creation and management of digital identities, registered using a Blockchain technology, connected by a validation process managed by identities already registered, making use of an authentication process through a digital signature.

A digital identity is understood as an identity with an asymmetric key encryption system, with a public key and a private key.The mechanism provides that one (or more) Root identity (controller of itself) is inserted which can then act as Controller and in this way guarantees for the new identities created. Each identity created can in turn be the controller of a new identity up to a maximum of 5 degrees of separation.

For the creation of an identity, the Controller must have received the public Key of the identity to be created and sign the aforementioned key using its private key, to certify its identity. The smartcontract will verify through the public key of the controller the signature affixed to the data of the new identity to be entered and only if all the checks are successful, an insertion will be made on the Ledger of the new record that identifies the new identity.

The controller (and only him) will also have the ability to change the status of an identity on the ledger, whose statuses can change to Active, Suspended or Revoked.

The data structure that models this case is Identity which is composed of two parts: baseEntry and statusEntry.


Identity:

```
Identity { 
  BaseEntry,
  StatusEntry
}
```

Base Entry: it contains the fixed data recorded at the time of the census.

```
BaseEntry {
  Address,
  Created,
  CreatedBy,
  Controller,
  PKeyBlob,
  KeyType,
  Details
}
  
```

Status Entry:represents the state of the identity at the time of the specified date.

```
StatusEntry {
  Address,
  SubAddress,
  ValidFrom,
  UpdatedBy,
  Status
}
  
```


### Operations

The SID application consists of two client-side software solutions, and a *smart contract* Blockchain. The first client application offers an interactive command line interface (*sid-command-line*) with which the user's personal wallet is managed. With it you can create, view and access your identities. The second application (*sid-rest-api*) instead offers an interface that can be viewed on the address ***http://localhost:8080/swagger-ui.html***. This interface exposes some APIs to interact with the functionality of the *smartcontract*.

### Client Installation

**System requirements**

- Java JRE 1.8 or higher
- Apache Maven 3.6.3 or higher
- Internet Connection without Proxy

**Installation**

After cloning the two client projects locally, it is possible through the terminal command (on each root of the two projects): ***mvn install*** to generate the two JARs.
Both JARs use Fabric credentials to connect to the Blockchain. These credentials are encapsulated inside a folder, called Wallet, which can be generated by following the official guide at this link [link](https://hyperledger-fabric.readthedocs.io/en/latest/write_first_app.html#first-the-application-enrolls-the-admin-user) to create that folder with Fabric credentials. After the Wallet folder has been created, it can be saved anywhere but its path must be entered as the value of an environment variable of the operating system (if this environment variable is not created, the two JARs will search for these configurations in the home of the user).

#### sid-command-line

The client is not interactive: to perform a single operation, it must be launched from the system shell with a specific command. The command is structured as follows (assuming that the Java JRE has been configured correctly):

	java - jar <path to the executable file>_
	
	- c <command: list, stat, gen , show> (mandatory)
	- p <password: password of your wallet> (mandatory)
	- a <address: address Key of identity that we want to display, mandatory together with the command SHOW> 
	- h  <HELP: Commands list> (optional)
	
Esempi:


		> java -jar wallet-tool.jar -c gen -p password
		> java -jar wallet-tool.jar -c list -p password
		> java -jar wallet-tool.jar -c stat -p password
		> java -jar wallet-tool.jar -c show -p password  -a 5aBCvP1QoskN5pSxL1nSA221utj5LBAfu



	
		
#### sid-rest-api

***

The application expects three API: Post, Get e Put:

 **POST** 
It allows a *controller* user to register a new identity.

The required parameters are:

- **ctrlAddr** : address of controller chosen from those present in your wallet
- **password** : password to access your wallet
- **pubKey**   : Publickey in Base64 format for the new user to be registered
	
		Request URL: 
		http://localhost:8080/identity/?ctrlAddr%20=addressController&password=password&pubKey=public

**GET** 

It allows you to retrieve the main information of an active identity. If the operation ends successfully, the following data structure is returned:

```
	SID {
		address	string
		controller	string
		created	string
		pubKey	string
		status	integer($int32)
	  }
```

The only parameter required is the address of an identity present and active on the ledger.

	Request URL: http://localhost:8080/identity/address

**PUT**
It allows you to change the status of an identity present on the ledger. There are three possible operations:<br />

- **activate** able to activate an identity that has no active status.<br />
- **suspend** able to temporarily suspend an identity, it can be reactivated by means of the appropriate activate operation at any time.<br />
- **revoke** able to revoke a user permanently, a revoked user can no longer be reactivated.<br />

The required parameters are:

- **addr**: address of the identities to which to make a change of state.
- **ctrlAddr** : address of the controller address controller chosen from those present in your wallet, and actually controller of the identities to be modified.
- **op** : operation name between revoke, activate, suspend.
- **password** : password to decrypt your wallet.
	
	
		Request URL http://localhost:8080/identity/address/revoke?ctrlAddr=controllerAddress&password=password

## Chaincode

### Installation

#### Prerequisites

* Linux Environment.
* Administrative access to the machine.
* Access to Internet.
* Install **Hyperledger Fabric version 1.4** following this installation [guide](https://hyperledger-fabric.readthedocs.io/en/latest/write_first_app.html#).
* Clone the repository.: `git clone https://github.com/Engineering-Research-and-Development/qu4lity-dapps.git`
* Copy the `chaincode` folder of SID project under your HLF installation machine.
* To install the chaincode follow the instructions given in the following guide: [guide](https://hyperledger-fabric.readthedocs.io/en/release-1.4/chaincode4noah.html#installing-chaincode#)
